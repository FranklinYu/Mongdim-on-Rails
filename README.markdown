# Mongdim

Mongdim is an online shop system.

Currently only [MRI][] 2.4.1 is supported.

[MRI]: https://en.wikipedia.org/wiki/Ruby_MRI

## deploy on server

Prerequisite:

 * Ruby (version shown in the file `.ruby-version`)
 * [PostgreSQL][]

[PostgreSQL]: https://www.postgresql.org/download/

First, make sure that you have Bundler installed:

    $ gem install bundler

Then install the bundle with Bundler

    $ bundle install --deployment --without development test doc

Set up the environment variables. Required environment variables:

  * `DATABASE_URL`: should be `production`.
  * `DATABASE_URL`: a [connection string][].
  * `SECRET_KEY_BASE`: bytes (over 30 bytes, typically 128 bytes) in hexadecimal
    form; can be generated by `bundle exec rails secret`.

Optional environment variables:

  * `PORT`: port of web service; default to 3000.
  * `MAX_THREADS`: maximal number of threads per-process; default to 5.
  * `MIN_THREADS`: minimal number of threads per-process; default to
    `MAX_THREADS` or 5.
  * `WEB_CONCURRENCY`: number of processes; default to 1.
  * `DB_POOL`: number of database connections; default to maximal number of all
    threads, or 5.

Now migrate the database:

    $ bundle exec rails db:migrate

Now you can launch Mongdim with Puma:

    $ bundle exec puma

[connection string]: https://www.postgresql.org/docs/9.6/static/libpq-connect.html#LIBPQ-CONNSTRING

### note for Heroku

Heroku Ruby buildpack [doesn't recognize `.ruby-version` file][ruby-version].
To deploy on Heroku, manually [spedify it in `Gemfile`][bundle-ruby].

[bundle-ruby]: https://bundler.io/v1.15/gemfile_ruby.html
[ruby-version]: https://github.com/heroku/heroku-buildpack-ruby/issues/568
